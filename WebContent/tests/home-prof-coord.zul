<?page title="Home" contentType="text/html;charset=UTF-8"?>
<?init class="br.ufjf.tcc.controller.AuthController"?>
<zk>
	<style src="/style.css" />
	<div apply="org.zkoss.bind.BindComposer" align="center"
		viewModel="@id('vm') @init('br.ufjf.tcc.teste.HomeProfCoordController')">
		<include src="@load(vm.menu)" />
		<hlayout spacing="0" height="100%">

			<grid hflex="1" style="margin:10px; margin-bottom:30px">
				<columns>
					<column label="Funções de coordenador"
						style="font-weight:bold;text-align:center" />
				</columns>
				<rows>
					<row
						visible="@load(vm.currentQuestionaryExists ? 'false' : 'true')">
						<vlayout>
							<label
								value="O seu curso ainda não possui um questionário para o semestre atual." />
							<hlayout>
								<button label="Criar"
									onClick="@command('createQuestionary', window=cadquest)" />
								<button
									label="Criar a partir de um antigo"
									onClick="@command('createQuestionaryFromOld', window=listquest)" />
							</hlayout>
						</vlayout>
					</row>
					<row
						visible="@load(vm.currentQuestionaryExists ? (vm.currentQuestionaryUsed ? 'false' : 'true') : 'false')">
						<vlayout>
							<label
								value="Como o questionário atual ainda não foi utilizado, você pode editá-lo." />
							<button label="Editar questionário"
								onClick="@command('editQuestionary', window=cadquest)" />
						</vlayout>
					</row>
				</rows>
			</grid>

			<grid hflex="3" model="@load(vm.tccs) @template('tccs')"
				style="margin:10px" width="700px" mold="paging" autopaging="true"
				vflex="true">
				<auxhead sclass="text-center">
					<auxheader colspan="4"
						label="TCCs com sua participação" />
				</auxhead>
				<columns>
					<column label="Aluno" hflex="1"
						sort="auto(tcc.aluno.nomeUsuario)" />
					<column label="Nome" hflex="3"
						sort="auto(tcc.nomeTCC)" />
					<column label="Data de Apresentação" hflex="1"
						sort="auto(tcc.dataApresentacao)" />
					<column label="Ação" hflex="1" />
				</columns>
				<template name="tccs">
					<row>
						<label value="@load(each.aluno.nomeUsuario)" />
						<label value="@load(each.nomeTCC)" />
						<label
							onCreate="@command('getTCCDateApresentacao', tcc=each, lbl=self)" />
						<div align="center">
							<button label="Responder"
								onClick="@command('answerTCC', tcc=each)"
								onCreate="@command('canAnswerTCC', tcc=each, btn=self)" />
						</div>
					</row>
				</template>
			</grid>
		</hlayout>
	</div>
	<window id="cadquest" title="Cadastrar Questionário" width="500px"
		border="normal" position="center,top" style="margin-top: 100px;"
		closable="true" visible="false" apply="org.zkoss.bind.BindComposer"
		viewModel="@id('vm') @init('br.ufjf.tcc.controller.CadastroQuestionarioController', cmbCurso=cmbCurso)">

		<vlayout style="margin:10px;">

			<tablelayout columns="3" width="100%"
				style="margin-bottom:10px;">

				<tablechildren>
					<vlayout>
						<label value="Curso:" />
						<combobox id="cmbCurso" width="200px"
							readonly="true" value="@bind(vm.newQuestionary.curso.nomeCurso)"
							model="@load(vm.cursos)"
							selectedItem="@bind(vm.newQuestionary.curso)"
							onSelect="@command('semester')" disabled="@load(not vm.admin)">
							<template name="model">
								<comboitem
									label="@load(each.nomeCurso)" />
							</template>
						</combobox>
					</vlayout>
				</tablechildren>

				<tablechildren>
					<vlayout>
						<label value="Semestre atual do curso: " />
						<label value="@load(vm.currentSemester)" />
					</vlayout>
				</tablechildren>

				<tablechildren style="float:right;">
					<checkbox id="ativo" label="Ativo"
						style="margin-right:20px;" checked="true" disabled="true" />
				</tablechildren>

			</tablelayout>

			<div id="questForm">
				<groupbox title="Perguntas">
					<grid model="@load(vm.questions)"
						style="margin-left:5px; margin-right:5px;">
						<columns>
							<column width="100px" />
							<column />
							<column width="50px" />
						</columns>
						<template name="model">
							<row>
								<label
									value="Pergunta ${forEachStatus.index + 1}: " />
								<textbox value="@bind(each.pergunta)"
									width="95%" />
								<button image="/img/delete.png"
									onClick="@command('removeQuestion', question=each)" />
							</row>
						</template>
					</grid>

					<div align="center">
						<button label="Adicionar pergunta"
							onClick="@command('addQuestion')" style="margin-top:5px;" />
					</div>
				</groupbox>
				<div align="center">
					<button label="Cadastrar Questionário"
						onClick="@command('submit', checkbox=ativo, window=cadquest)"
						style="margin-top:15px;" />
				</div>
			</div>
		</vlayout>
	</window>
	<window id="listquest" title="Questionários" width="300px"
		border="normal" position="center,top" style="margin-top: 100px;"
		closable="true" apply="org.zkoss.bind.BindComposer"
		viewModel="@id('vm') @init('br.ufjf.tcc.controller.ListaQuestionariosController', cmb=cmbCurso)">

		<grid model="@load(vm.questionaries)"
			emptyMessage="Não existem questionários antigos">
			<columns>
				<column label="id" />
				<column label="Calendário" />
			</columns>
			<template name="model">
				<row
					onClick="@command('selectQuestionary', quest=each, window=listquest, window2=cadquest)">
					<label value="@load(each.idQuestionario)" />
					<label
						value="@load(each.calendarioSemestre.nomeCalendarioSemestre)" />
				</row>
			</template>
		</grid>
	</window>
</zk>